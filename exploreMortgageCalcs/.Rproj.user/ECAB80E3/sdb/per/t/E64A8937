{
    "contents" : "\n# load libraries\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(rbokeh)\n\n# get payment per month for a given term (yrs), annual interest (%), loan amount ($)\n\nmnthpymt = function(term,apr,loan){\n    \n    numpays = term * 12\n    ifact = 1/(1+(apr*0.01/12))\n  \n    pymt = loan *  (1 - ifact)/(1 - ifact ** numpays) * (1/ifact)\n\n    return(pymt)\n}\n\n\n# 5 yr adj rate smart mortgage\n\n\npaystruct = function(chgpts,chgfee,termyr,apryr,initloan,xtrapymt,numyrs){\n  \n    loanresid = rep(0,numyrs*12) # remaining loan at the end of month\n    intmnth = rep(0,numyrs*12) # interest in a month\n    totpay = rep(0,numyrs*12) # cumulative payment upto a month\n    mnthpay = rep(0,numyrs*12) # monthly payment\n    equity = rep(0,numyrs*12) # equity build upto a month\n    netpay = rep(0,numyrs*12) # net payment\n  \n    for(i in 1:numyrs){\n        if(chgpts[i] == 1){\n            loanamt = ifelse(i == 1, initloan, loanresid[(i-1)*12])\n            pymt = mnthpymt(termyr[i],apryr[i],loanamt)\n        }\n        for(j in 1:12){\n            mnthnum = (i-1) *12 + j\n            prevloan = ifelse(mnthnum == 1, initloan, loanresid[mnthnum - 1])\n            intmnth[mnthnum] = prevloan * apryr[i]*0.01/12\n            \n            chgfeemnth = ifelse(j == 1,chgfee[i],0)\n            mnthpay[mnthnum] = ifelse(prevloan > 0, pymt + xtrapymt[i] + chgfeemnth,0)\n            loanresid[mnthnum] = max(prevloan - (mnthpay[mnthnum] - intmnth[mnthnum] - chgfeemnth),0)\n            equity[mnthnum] = initloan - loanresid[mnthnum]\n            \n            if(mnthnum > 1){\n                totpay[mnthnum] = totpay[mnthnum - 1] + mnthpay[mnthnum]\n              } else {\n                totpay[mnthnum] = mnthpay[mnthnum]\n              }\n            \n            netpay[mnthnum] = totpay[mnthnum] - equity[mnthnum]\n            \n            }\n        \n        }\n  \n    df = data.frame(mnth = seq(1,numyrs*12),\n                    totpay = totpay,\n                    netpay = netpay,\n                    intmnth = intmnth,\n                    loanresid = loanresid,\n                    equity = equity,\n                    mnthpay = mnthpay)\n    return(df)\n  \n}\n\n\ninitloan = 200000\n\nchgpts = rep(0,30)\nchgfee = rep(0,30)\ntermyr = rep(30,30)\napryr = rep(4.25,30)\n#xtrapymt = rep(0,30)\nxtrapymt = rep(180,30)\nnumyrs = 30\nchgpts[1] = 1\n\npayfixed = paystruct(chgpts,chgfee,termyr,apryr,initloan,xtrapymt,numyrs)\n\n\nggplot(data=payfixed) + geom_line(aes(x=mnth/12,y=loanresid/1000))+\n    scale_x_continuous(breaks = seq(0,numyrs))+scale_y_continuous(label=dollar)+theme_bw()\nggplot(data=payfixed) + geom_line(aes(x=mnth/12,y=netpay))+\n  scale_x_continuous(breaks = seq(0,numyrs))+scale_y_continuous(label=dollar)+theme_bw()\nggplot(data=payfixed) + geom_line(aes(x=mnth/12,y=totpay))+\n  scale_x_continuous(breaks = seq(0,numyrs))+scale_y_continuous(label=dollar)+theme_bw()\n\nggplot(data=payfixed,aes(x=mnth/12,y=mnthpay)) + geom_line()+\n  scale_x_continuous(breaks = seq(0,numyrs))+theme_bw()\n\n\nfigure()%>%ly_lines(mnth/12,loanresid/1000,data=payfixed)\nfigure()%>%ly_lines(mnth/12,netpay/1000,data=payfixed)\nfigure()%>%ly_lines(mnth/12,totpay/1000,data=payfixed)\nfigure()%>%ly_lines(mnth/12,mnthpay,data=payfixed)\n\n\ninitloan = 200000\nnumyrs = 30\nchgpts = rep(0,30)\nchgpts[c(1,6,11)] = 1\nchgfee = rep(0,30)\nchgfee[1] = 3200\nchgfee[c(6,11)] = 500\ntermyr = rep(30,30)\ntermyr = seq(30,1)\napryr = c(rep(2.65,5),rep(5,5),rep(8,20))\nxtrapymt = rep(180,30)\n\npayadj = paystruct(chgpts,chgfee,termyr,apryr,initloan,xtrapymt,numyrs)\n\nggplot()+\n  geom_line(data=payfixed,aes(x=mnth/12,y=mnthpay),color=\"red\") + \n  geom_line(data=payadj,aes(x=mnth/12,y=mnthpay),color=\"blue\") + \n  scale_x_continuous(breaks = seq(0,numyrs))+scale_y_continuous(label=dollar)+theme_bw()\n\nfigure()%>%\n  ly_lines(mnth/12,mnthpay,data=payfixed,color=\"red\")%>%\n  ly_lines(mnth/12,mnthpay,data=payadj,color=\"blue\")\n\n\nggplot()+\n    geom_line(data=payfixed,aes(x=mnth/12,y=netpay),color=\"red\") + \n    geom_line(data=payadj,aes(x=mnth/12,y=netpay),color=\"blue\") + \n  scale_x_continuous(breaks = seq(0,numyrs))+scale_y_continuous(label=dollar)+theme_bw()\n\nfigure()%>%\n  ly_lines(mnth/12,netpay,data=payfixed,color=\"red\")%>%\n  ly_lines(mnth/12,netpay,data=payadj,color=\"blue\")\n\n\npayfixedvsadj = data.frame(mnth = payfixed$mnth,\n                           netpayfixed = payfixed$netpay,\n                           netpayadj = payadj$netpay)\npayfixedvsadj$deltapay = payfixedvsadj$netpayfixed - payfixedvsadj$netpayadj\n\nggplot()+\n  geom_line(data=payfixedvsadj,aes(x=mnth/12,y=deltapay),color=\"red\") + \n  geom_hline(aes(yintercept = 0),color=\"blue\")+\n  scale_x_continuous(breaks = seq(0,numyrs))+scale_y_continuous(label=dollar)+theme_bw()\n\nfigure() %>% ly_lines(mnth/12,deltapay/1000,data=payfixedvsadj,color=\"blue\")\n",
    "created" : 1424056351783.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3053309530",
    "id" : "E64A8937",
    "lastKnownWriteTime" : 1424626936,
    "path" : "~/notesofdabbler/githubfolder/blog_notesofdabbler/exploreMortgageCalcs/chk_mortgagePlans.R",
    "project_path" : "chk_mortgagePlans.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}